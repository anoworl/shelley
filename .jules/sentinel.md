## 2025-05-27 - Path Traversal in File Serving Handler
**Vulnerability:** A path traversal vulnerability was found in `handleRead` in `server/handlers.go`. The handler accepted a `path` query parameter and checked if it started with a specific allowed directory prefix using `strings.HasPrefix`. However, it did not clean the path before this check, allowing attackers to use `../` sequences to traverse out of the allowed directory after the prefix match (e.g., `/allowed/../etc/passwd`).
**Learning:** `strings.HasPrefix` is insufficient for validating file paths when user input can contain `..` or other traversal characters. The path must be canonicalized before validation.
**Prevention:** Always use `filepath.Clean()` (or `filepath.Abs()` if dealing with absolute paths) to resolve directory traversal sequences before performing any prefix checks or access control logic. Ensure the prefix check includes a trailing separator to prevent partial name matching (e.g., `/tmp/dir` matching `/tmp/directory`).

## 2026-01-14 - Arbitrary File Write in File Editing Handler
**Vulnerability:** An arbitrary file write vulnerability was found in `handleWriteFile` in `server/handlers.go`. The handler only checked if the path was absolute (`filepath.IsAbs`) but did not verify that the path was within an allowed directory (like a git repository). This allowed attackers to overwrite any file the server process had write access to.
**Learning:** Checking for absolute paths is not an access control mechanism. Explicit boundary checks (e.g., ensuring the file is inside a git repository) are required. Also, specific directories like `.git` must be explicitly protected.
**Prevention:** Verify that the target file resides within an allowed boundary (e.g., using `gitstate.GetGitState(dir).IsRepo`). Explicitly block writing to sensitive directories like `.git` using case-insensitive checks.
