## 2025-05-27 - Path Traversal in File Serving Handler
**Vulnerability:** A path traversal vulnerability was found in `handleRead` in `server/handlers.go`. The handler accepted a `path` query parameter and checked if it started with a specific allowed directory prefix using `strings.HasPrefix`. However, it did not clean the path before this check, allowing attackers to use `../` sequences to traverse out of the allowed directory after the prefix match (e.g., `/allowed/../etc/passwd`).
**Learning:** `strings.HasPrefix` is insufficient for validating file paths when user input can contain `..` or other traversal characters. The path must be canonicalized before validation.
**Prevention:** Always use `filepath.Clean()` (or `filepath.Abs()` if dealing with absolute paths) to resolve directory traversal sequences before performing any prefix checks or access control logic. Ensure the prefix check includes a trailing separator to prevent partial name matching (e.g., `/tmp/dir` matching `/tmp/directory`).

## 2026-01-15 - Stored XSS in File Upload Handler
**Vulnerability:** A stored XSS vulnerability was identified in `handleUpload` in `server/handlers.go`. The handler allowed uploading files with arbitrary extensions (e.g., `.html`, `.svg`) to a public directory. The `handleRead` endpoint would then serve these files with `Content-Type: text/html` (due to content sniffing or explicit extension matching), allowing execution of malicious scripts stored in the file when viewed by a user.
**Learning:** Relying on `filepath.Ext` without validation allows users to upload executable content to static file directories. `http.DetectContentType` or similar sniffing mechanisms can inadvertently make these files dangerous if served back to the browser.
**Prevention:** Implement a strict allowlist of file extensions (e.g., `.png`, `.jpg`) for file uploads. Additionally, ensure the file serving handler (`handleRead`) does not sniff content types for unknown extensions or forces them to `application/octet-stream`.
