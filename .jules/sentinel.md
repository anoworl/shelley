## 2025-05-27 - Path Traversal in File Serving Handler
**Vulnerability:** A path traversal vulnerability was found in `handleRead` in `server/handlers.go`. The handler accepted a `path` query parameter and checked if it started with a specific allowed directory prefix using `strings.HasPrefix`. However, it did not clean the path before this check, allowing attackers to use `../` sequences to traverse out of the allowed directory after the prefix match (e.g., `/allowed/../etc/passwd`).
**Learning:** `strings.HasPrefix` is insufficient for validating file paths when user input can contain `..` or other traversal characters. The path must be canonicalized before validation.
**Prevention:** Always use `filepath.Clean()` (or `filepath.Abs()` if dealing with absolute paths) to resolve directory traversal sequences before performing any prefix checks or access control logic. Ensure the prefix check includes a trailing separator to prevent partial name matching (e.g., `/tmp/dir` matching `/tmp/directory`).

## 2026-01-19 - Unrestricted File Upload in Screenshot Handler
**Vulnerability:** The `handleUpload` function in `server/handlers.go` allowed uploading files with any extension. The filename was randomized but the extension was preserved. Since `handleRead` sets the `Content-Type` based on extension (or sniffing), uploading an `.html` file allowed serving it as `text/html`, leading to Stored XSS.
**Learning:** Preserving user-supplied file extensions without validation is dangerous, especially when the file is served back to the user. Even with randomized filenames, the extension determines how the browser handles the content.
**Prevention:** Implement a strict allowlist of file extensions for uploads. Do not rely on client-side validation or blacklists. Ensure the `Content-Type` served matches the expected type and use `X-Content-Type-Options: nosniff` header (though strictly validating extension is the primary fix here).
**Note:** This fix was REJECTED for this specific project because it is a single-user application with no external input, so self-XSS was deemed an unrealistic threat model. However, the principle remains valid for multi-user applications.
